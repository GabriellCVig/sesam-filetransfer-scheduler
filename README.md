[![Build Status](https://travis-ci.org/sesam-community/sesam-filetransfer-scheduler.svg?branch=master)](https://travis-ci.org/sesam-community/sesam-filetransfer-scheduler)

# sesam-filetransfer-scheduler
I forward files on a user-defined cron-schedule from an INPUT_URL to an OUTPUT_URL.

I also support JWT authorization.


#Configuration
## Environment variables
```json
{
    "INPUT_URL": "",
    "OUTPUT_URL": "",
    "<key-values below are default/optionally set": "",
    "CRON": "*/5  *  *  *  *",
    "LOG_LEVEL": "<sesam-utils-default>",
    "INPUT_JWT" : null,
    "OUTPUT_JWT" : null,
    "OUTPUT_CONTENT_TYPE" : "application/json; charset=utf-8",
    "LOG_TIMESTAMP" : true
}
```
## Typical Sesam setup
This configuration is set to grab a CSV file generated by a pipe every friday at 3:00AM (03:00) and forward it.

Explanation of OUTPUT_URL in this case:
It forwards it to the dynamicurl-proxy microservice which dynamically changes the URL(filename) based on date.  Afterwards it is forwarded to and ftp microservice, uploading the timestamp-named file.
```json
[{
  "_id": "sesam-filetransfer-scheduler",
  "type": "system:microservice",
  "connect_timeout": 60,
  "docker": {
    "environment": {
        "CRON": "0 3 * * FRI",
        "INPUT_URL": "https://<***>.sesam.cloud/api/publishers/some-csv-endpoint/csv",
        "OUTPUT_URL": "http://dynamicurl-proxy-service:5000?url=http://ftp:5000/somefolder/filename_[datestr].csv&datestr=datetime.datetime.now().strftime('%Y%m%d_%H%M%S')",
        "INPUT_JWT" : "ey***",
        "OUTPUT_JWT" : "ey***",
        "OUTPUT_CONTENT_TYPE" : "text/csv; charset=cp1252",
        "LOG_LEVEL": "INFO"
    },
    "image": "sesamcommunity/sesam-filetransfer-scheduler:1.0.0",
    "port": 5000
  },
  "read_timeout": 7200,
  "verify_ssl": false
},
{
  "_id": "some-csv-endpoint",
  "type": "pipe",
  "source": {
    "type": "embedded",
    "entities": {
      "_id": "test",
      "val1": "a",
      "val2": "b",
      "val3": "c"
    }
  },
  "sink": {
    "type": "csv_endpoint",
    "columns": ["val1", "val2", "val3"],
    "delimiter": "\t",
    "encoding": "cp1252",
    "lineterminator": "\r\n"
  }
}]
```

# What can i do to improve this?
* Add more authorization options